{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#b91c1c" />
  <title>{% block title %}Rent a Driver{% endblock %}</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts & Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  {% block extra_head %}{% endblock %}
</head>
<body class="bg-white text-gray-900 min-h-screen flex flex-col">
  <!-- NAVBAR -->
  <nav class="navbar" id="navbar">
    <div class="container">
      <h2 class="logo">
        <a href="/">
          <span class="brand-main">Rent</span><span class="brand-accent">ADriver</span>
        </a>
      </h2>
      <div class="nav-links">
        <!-- Dynamic Nav Items -->
        <a id="navDashboard" href="/customer/dashboard/" class="nav-hidden">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Dashboard
        </a>
        <a id="navDriver" href="/driver/dashboard/" class="nav-hidden">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10c-.3-.8-1-1.4-1.9-1.4H7.5c-.9 0-1.6.6-1.9 1.4L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"/>
            <circle cx="7" cy="17" r="2"/>
            <circle cx="17" cy="17" r="2"/>
          </svg>
          Driver
        </a>
        <a id="navEmergency" href="/emergency/" class="nav-hidden">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          Emergency
        </a>
        <a id="navLeaderboard" href="/leaderboard/" class="nav-hidden">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
            <path d="M4 22h16"/>
            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
          </svg>
          Leaderboard
        </a>
        <!-- Auth Links -->
        <a id="navLogin" href="/login/" class="nav-visible">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
            <polyline points="10,17 15,12 10,7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
          </svg>
          Login
        </a>
        <a id="navRegister" class="btn nav-visible" href="/register/">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          Get Started
        </a>
        <a id="navLogout" href="#" class="nav-hidden">
          <svg class="nav-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16,17 21,12 16,7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Logout
        </a>
      </div>
    </div>
  </nav>
<!-- MAIN CONTENT -->
  <main class="page container flex-grow">
    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer>
    <p>Â© 2025 RentADriver | All rights reserved</p>
  </footer>

  <!-- CORE SCRIPTS - -->
  <script src="{% static 'js/main.js' %}"></script>

  <!-- Enhanced Navigation Management Script -->
  <script>
    // Enhanced navigation management with scroll effects and active states
    class NavbarManager {
      constructor() {
        this.navbar = document.getElementById('navbar');
        this.lastScrollY = 0;
        this.init();
      }

      init() {
        this.setupScrollEffects();
        this.setupActiveLinks();
        this.initializeAuth();
      }

      // Add scroll effects to navbar
      setupScrollEffects() {
        let ticking = false;
        
        const updateNavbar = () => {
          const scrollY = window.scrollY;
          
          if (scrollY > 100) {
            this.navbar.classList.add('scrolled');
          } else {
            this.navbar.classList.remove('scrolled');
          }
          
          this.lastScrollY = scrollY;
          ticking = false;
        };

        window.addEventListener('scroll', () => {
          if (!ticking) {
            requestAnimationFrame(updateNavbar);
            ticking = true;
          }
        });
      }

      // Set active link based on current page
      setupActiveLinks() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-links a');
        
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
          }
        });
      }

      // Initialize authentication state
      initializeAuth() {
        const token = localStorage.getItem('access');
        const userRole = localStorage.getItem('userRole') || 'guest';
        
        console.log('ðŸ” NAVBAR DEBUG:', { token: !!token, userRole, authenticated: !!token });
        
        this.updateNav({ 
          authenticated: !!token, 
          role: userRole 
        });

        
        // ðŸ†˜ FORCE UPDATE AFTER SMALL DELAY
        setTimeout(() => {
          this.updateNav({ 
            authenticated: !!token, 
            role: userRole 
          });
        }, 100);
      }
      // Enhanced navigation update with animations
      updateNav({ authenticated = false, role = null } = {}) {
        console.log('ðŸ”„ UPDATING NAV:', { authenticated, role });
        
        const navElements = {
          login: document.getElementById('navLogin'),
          register: document.getElementById('navRegister'),
          logout: document.getElementById('navLogout'),
          dashboard: document.getElementById('navDashboard'),
          driver: document.getElementById('navDriver'),
          emergency: document.getElementById('navEmergency'),
          leaderboard: document.getElementById('navLeaderboard')
        };

        // Hide all role-specific items first
        Object.values(navElements).forEach(el => {
          if (el && el.id !== 'navLogin' && el.id !== 'navRegister') {
            this.hideElement(el);
          }
        });

        if (authenticated) {
          console.log('ðŸ” User is authenticated, role:', role);
          // Hide auth links, show logout
          this.hideElement(navElements.login);
          this.hideElement(navElements.register);
          this.showElement(navElements.logout);

          // Show role-specific navigation
          switch (role) {
            case 'customer':
            case 'buyer':
              console.log('ðŸ‘¤ Showing customer nav');
              this.showElement(navElements.dashboard);
              this.showElement(navElements.emergency);    // âœ… SHOW FOR CUSTOMERS
              this.showElement(navElements.leaderboard); // âœ… SHOW FOR CUSTOMERS
              break;
            case 'driver':
              console.log('ðŸš— Showing driver nav');
              this.showElement(navElements.driver);
              this.showElement(navElements.emergency);    // âœ… SHOW FOR DRIVERS
              this.showElement(navElements.leaderboard); // âœ… SHOW FOR DRIVERS
              break;
            case 'admin':
              console.log('ðŸ”‘ Showing admin nav');
              this.showElement(navElements.emergency);
              this.showElement(navElements.leaderboard);
              this.showElement(navElements.dashboard);
              this.showElement(navElements.driver);
              break;
            default:
              console.log('âš ï¸ Unknown role:', role, '- treating as customer');
              this.showElement(navElements.dashboard);
              this.showElement(navElements.emergency);
              this.showElement(navElements.leaderboard);
          }
        } else {
          console.log('ðŸšª User not authenticated');
          // Show auth links, hide logout
          this.showElement(navElements.login);
          this.showElement(navElements.register);
          this.hideElement(navElements.logout);
        }
        
        console.log('âœ… Nav update complete');
      }

      showElement(element) {
        if (element) {
          element.classList.remove('nav-hidden');
          element.classList.add('nav-visible');
        }
      }

      hideElement(element) {
        if (element) {
          element.classList.add('nav-hidden');
          element.classList.remove('nav-visible');
        }
      }
    }
    // Enhanced navigation update with animations
      updateNav({ authenticated = false, role = null } = {}) {
        console.log('ðŸ”„ UPDATING NAV:', { authenticated, role });
        
        const navElements = {
          login: document.getElementById('navLogin'),
          register: document.getElementById('navRegister'),
          logout: document.getElementById('navLogout'),
          dashboard: document.getElementById('navDashboard'),
          driver: document.getElementById('navDriver'),
          emergency: document.getElementById('navEmergency'),
          leaderboard: document.getElementById('navLeaderboard')
        };

        // Hide all role-specific items first
        Object.values(navElements).forEach(el => {
          if (el && el.id !== 'navLogin' && el.id !== 'navRegister') {
            this.hideElement(el);
          }
        });

        if (authenticated) {
          console.log('ðŸ” User is authenticated, role:', role);
          // Hide auth links, show logout
          this.hideElement(navElements.login);
          this.hideElement(navElements.register);
          this.showElement(navElements.logout);

          // Show role-specific navigation
          switch (role) {
            case 'customer':
            case 'buyer':
              console.log('ðŸ‘¤ Showing customer nav');
              this.showElement(navElements.dashboard);
              this.showElement(navElements.emergency);    // âœ… SHOW FOR CUSTOMERS
              this.showElement(navElements.leaderboard); // âœ… SHOW FOR CUSTOMERS
              break;
            case 'driver':
              console.log('ðŸš— Showing driver nav');
              this.showElement(navElements.driver);
              this.showElement(navElements.emergency);    // âœ… SHOW FOR DRIVERS
              this.showElement(navElements.leaderboard); // âœ… SHOW FOR DRIVERS
              break;
            case 'admin':
              console.log('ðŸ”‘ Showing admin nav');
              this.showElement(navElements.emergency);
              this.showElement(navElements.leaderboard);
              this.showElement(navElements.dashboard);
              this.showElement(navElements.driver);
              break;
            default:
              console.log('âš ï¸ Unknown role:', role, '- treating as customer');
              this.showElement(navElements.dashboard);
              this.showElement(navElements.emergency);
              this.showElement(navElements.leaderboard);
          }
        } else {
          console.log('ðŸšª User not authenticated');
          // Show auth links, hide logout
          this.showElement(navElements.login);
          this.showElement(navElements.register);
          this.hideElement(navElements.logout);
        }
        
        console.log('âœ… Nav update complete');
      }

      showElement(element) {
        if (element) {
          element.classList.remove('nav-hidden');
          element.classList.add('nav-visible');
        }
      }

      hideElement(element) {
        if (element) {
          element.classList.add('nav-hidden');
          element.classList.remove('nav-visible');
        }
      }
    }
You
9:19â€¯PM
hii
Mahima
9:19â€¯PM
// Global function for backward compatibility
    window.updateNav = function(options) {
      if (window.navbarManager) {
        window.navbarManager.updateNav(options);
      }
    };

    // âœ… DEBUG HELPER - Remove in production
    window.testNav = function(role) {
      const roles = ['guest', 'customer', 'driver', 'admin'];
      const testRole = role || roles[Math.floor(Math.random() * roles.length)];
      console.log(`Testing navigation for role: ${testRole}`);
      
      if (testRole === 'guest') {
        localStorage.removeItem('access');
        localStorage.removeItem('userRole');
      } else {
        localStorage.setItem('access', 'test-token');
        localStorage.setItem('userRole', testRole);
      }
      
      window.navbarManager.updateNav({ 
        authenticated: testRole !== 'guest', 
        role: testRole 
      });
    };
    
    // ðŸ†˜ EMERGENCY NAV FIX - GLOBAL TRIGGER
    window.forceNavUpdate = function() {
      const token = localStorage.getItem('access');
      const userRole = localStorage.getItem('userRole') || 'customer';
      console.log('ðŸ”¥ FORCE NAV UPDATE TRIGGERED:', { token: !!token, userRole });
      
      if (window.navbarManager) {
        window.navbarManager.updateNav({ 
          authenticated: !!token, 
          role: userRole 
        });
      }
      
      // ðŸ†˜ ALSO MANUALLY SHOW/HIDE ELEMENTS
      const elements = {
        login: document.getElementById('navLogin'),
        register: document.getElementById('navRegister'),
        logout: document.getElementById('navLogout'),
        dashboard: document.getElementById('navDashboard'),
        driver: document.getElementById('navDriver'),
        emergency: document.getElementById('navEmergency'),
        leaderboard: document.getElementById('navLeaderboard')
      };
      
      // Hide all first
      Object.values(elements).forEach(el => {
        if (el) {
          el.classList.add('nav-hidden');
          el.classList.remove('nav-visible');
        }
      });
      
      if (token) {
        // Show authenticated nav
        if (elements.logout) {
          elements.logout.classList.remove('nav-hidden');
          elements.logout.classList.add('nav-visible');
        }
        
        if (userRole === 'customer' || userRole === 'buyer') {
          [elements.dashboard, elements.emergency, elements.leaderboard].forEach(el => {
            if (el) {
              el.classList.remove('nav-hidden');
              el.classList.add('nav-visible');
            }
          });
        } else if (userRole === 'driver') {
          [elements.driver, elements.emergency, elements.leaderboard].forEach(el => {
            if (el) {
              el.classList.remove('nav-hidden');
              el.classList.add('nav-visible');
            }
          });
        }
      } else {
        // Show unauthenticated nav
        [elements.login, elements.register].forEach(el => {
          if (el) {
            el.classList.remove('nav-hidden');
            el.classList.add('nav-visible');
          }
        });
      }
      
      console.log('âœ… Force nav update complete');
    };

    // Initialize navbar when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      window.navbarManager = new NavbarManager();
      
      // ðŸ†˜ FORCE IMMEDIATE NAV UPDATE
      setTimeout(() => {
        const token = localStorage.getItem('access');
        const userRole = localStorage.getItem('userRole') || 'customer'; // DEFAULT TO CUSTOMER
        console.log('ðŸš€ FORCE NAV UPDATE:', { token: !!token, userRole });
        window.navbarManager.updateNav({ 
          authenticated: !!token, 
          role: userRole 
        });
      }, 200);
      
      // Add smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    });
    
    // ðŸ†˜ ALSO UPDATE NAV ON PAGE LOAD/NAVIGATION
    window.addEventListener('load', function() {
      if (window.navbarManager) {
        const token = localStorage.getItem('access');
        const userRole = localStorage.getItem('userRole') || 'customer';
        console.log('ðŸ”„ Window load - updating nav:', { token: !!token, userRole });
        window.navbarManager.updateNav({ 
          authenticated: !!token, 
          role: userRole 
        });
      }
    });
  </script>

  <!-- Page-Specific Scripts -->
  {% block extra_scripts %}
    <script src="{% static 'js/customer.js' %}"></script>
    <script src="{% static 'js/driver.js' %}"></script>
    <script src="{% static 'js/driver_profile.js' %}"></script>
    <script src="{% static 'js/leaderboard.js' %}"></script>
    <script src="{% static 'js/emergency.js' %}"></script>
  {% endblock %}
</body>
</html>